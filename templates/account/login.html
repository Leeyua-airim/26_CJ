{% extends "base.html" %}
{% load socialaccount %}

{% block title %}로그인 | CJ AI Agent{% endblock %}

{% block body %}
  <div class="header">
    <div class="brand">
      <div class="dots">
        <div class="dot blue"></div>
        <div class="dot red"></div>
        <div class="dot yellow"></div>
      </div>
      <div>CJ 인재원 | 그룹 CDP Test</div>
    </div>

    <div class="badge">
      <span class="bar"></span>
      <span>Google 우선 로그인</span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2 style="margin:0;">로그인 안내</h2>
      <div class="muted" style="margin-top:10px;">
        일반 사용자는 <b>Google 로그인</b>으로 빠르게 접속합니다.<br/>
        기업회원은 필요 시 <b>로컬 계정</b>(보조)으로도 접속할 수 있습니다.<br/><br/>

        회원가입은 기본적으로 닫혀 있으며,<br/>
        기업회원은 <b>초대 링크</b>를 통해서만 가입이 가능합니다.
      </div>

      <div class="divider"></div>

      <div class="muted">
        로그인 성공 후에는 간단 화면으로 이동하며,<br/>
        상단에 <b>사용자 이메일</b>이 표시됩니다.
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0;">Google 로그인</h2>

      <div style="margin-top:14px;">
        {# next=/app/ 으로 이동을 확정합니다 #}
        <a href="{% provider_login_url 'google' %}?next=/app/" style="text-decoration:none;">
          <button class="btn btn-google" type="button">Google로 로그인</button>
        </a>
      </div>

      <div class="divider"></div>

      <div class="muted" style="font-weight:800;">로컬 로그인(기업회원 전용)</div>

      {% if form.errors %}
        <div class="error">
          입력값을 확인해 주세요.
        </div>
      {% endif %}

      <form method="post" action="{% url 'account_login' %}">
        {% csrf_token %}

        <div class="field">
            <label for="id_affiliation">소속</label>
            <select id="id_affiliation" name="affiliation" required>
            <option value="" selected disabled>소속을 선택해 주세요</option>
            <option value="HQ">지주사</option>
            <option value="OV">올리브영</option>
            <option value="DT">대한통운</option>
            <option value="JJ">제일제당</option>
            <option value="ENM">ENM</option>
            <option value="FD">푸드빌</option>
            </select>
        </div>

        <div class="field">
            <label for="id_employee_no">사번</label>
            <input
            id="id_employee_no"
            name="employee_no"
            type="text"
            autocomplete="username"
            placeholder="예: CJ000001"
            required
            />
        </div>

        <div class="field">
            <label for="id_password">비밀번호</label>
            <input
            id="id_password"
            name="password"
            type="password"
            autocomplete="current-password"
            placeholder="비밀번호"
            required
            />
        </div>

        {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
        {% else %}
            <input type="hidden" name="{{ redirect_field_name }}" value="/app/" />
        {% endif %}

        <!-- 🔎 디버그용: 실패 원인을 화면에서 바로 확인 -->
        {% if form.errors %}
        <div class="error">
            <div><b>form.errors</b></div>
            <pre style="white-space:pre-wrap;">{{ form.errors }}</pre>
        </div>
        {% endif %}

        {% if form.non_field_errors %}
        <div class="error">
            <div><b>non_field_errors</b></div>
            <pre style="white-space:pre-wrap;">{{ form.non_field_errors }}</pre>
        </div>
        {% endif %}

            <div style="margin-top:14px;">
                <button class="btn btn-secondary" type="submit">로컬 로그인</button>
            </div>
        </form>
    </div>
  </div>
{% endblock %}
